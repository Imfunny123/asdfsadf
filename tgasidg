local Color = Color3.fromHSV(0,1,1)
coroutine.wrap(function()
	local r = 255
	local g = 255
	local b = 255
	while wait() do
		for i = 0,1,0.001*0.8 do
			Color = Color3.fromHSV(i,1,1)
			wait()
		end
	end
end)()

local plr = game.Players.LocalPlayer
local camera = game.Workspace.CurrentCamera

for i, v in pairs(game.Players:GetChildren()) do
	local Top = Drawing.new("Line")
	Top.Visible = false
	Top.From = Vector2.new(0, 0)
	Top.To = Vector2.new(200, 200)
	coroutine.wrap(function()
		while wait() do
			Top.Color = Color
		end
	end)()
	Top.Thickness = 2
	Top.Transparency = 1

	local Bottom = Drawing.new("Line")
	Bottom.Visible = false
	Bottom.From = Vector2.new(0, 0)
	Bottom.To = Vector2.new(200, 200)
	coroutine.wrap(function()
		while wait() do
			Bottom.Color = Color
		end
	end)()
	Bottom.Thickness = 2
	Bottom.Transparency = 1

	local Left = Drawing.new("Line")
	Left.Visible = false
	Left.From = Vector2.new(0, 0)
	Left.To = Vector2.new(200, 200)
	coroutine.wrap(function()
		while wait() do
			Left.Color = Color
		end
	end)()
	Left.Thickness = 2
	Left.Transparency = 1

	local Right = Drawing.new("Line")
	Right.Visible = false
	Right.From = Vector2.new(0, 0)
	Right.To = Vector2.new(200, 200)
	coroutine.wrap(function()
		while wait() do
			Right.Color = Color
		end
	end)()
	Right.Thickness = 2
	Right.Transparency = 1

	local TopName = Drawing.new("Text")
	coroutine.wrap(function()
		while wait() do
			TopName.Color = Color
		end
	end)()
	TopName.Outline = true
	TopName.Size = 20
	TopName.Center = false
	TopName.Visible = false -- these 2 don't matter, they get overwritten
	TopName.Position = Vector2.new()
	
	local PlrName = Drawing.new("Text")
	coroutine.wrap(function()
		while wait() do
			PlrName.Color = Color
		end
	end)()
	PlrName.Outline = true
	PlrName.Size = 20
	PlrName.Visible = false
	PlrName.Center = false
	PlrName.Position = Vector2.new()
	
	function ESP()
		local connection
		connection = game:GetService("RunService").RenderStepped:Connect(function()
			if v.Character ~= nil and v.Character:FindFirstChild("HumanoidRootPart") ~= nil and v.Name ~= plr.Name  and v.Character.Humanoid.Health > 0 then 
				local ScreenPos, OnScreen = camera:WorldToViewportPoint(v.Character.HumanoidRootPart.Position)
				if OnScreen then
					local Scale = v.Character.Head.Size.Y/2
					local Size = Vector3.new(2, 3, 0) * (Scale * 2)
					local humpos = camera:WorldToViewportPoint(v.Character.HumanoidRootPart.Position)
					local TL = camera:WorldToViewportPoint((v.Character.HumanoidRootPart.CFrame * CFrame.new(Size.X, Size.Y, 0)).p)
					local TR = camera:WorldToViewportPoint((v.Character.HumanoidRootPart.CFrame * CFrame.new(-Size.X, Size.Y, 0)).p)
					local BL = camera:WorldToViewportPoint((v.Character.HumanoidRootPart.CFrame * CFrame.new(Size.X, -Size.Y, 0)).p)
					local BR = camera:WorldToViewportPoint((v.Character.HumanoidRootPart.CFrame * CFrame.new(-Size.X, -Size.Y, 0)).p)

					Top.From = Vector2.new(TL.X, TL.Y)
					Top.To = Vector2.new(TR.X, TR.Y)

					Left.From = Vector2.new(TL.X, TL.Y)
					Left.To = Vector2.new(BL.X, BL.Y)

					Right.From = Vector2.new(TR.X, TR.Y)
					Right.To = Vector2.new(BR.X, BR.Y)

					Bottom.From = Vector2.new(BL.X, BL.Y)
					Bottom.To = Vector2.new(BR.X, BR.Y)
					
					local healthRatio =
						v.Character:FindFirstChildOfClass("Humanoid").Health /
						v.Character:FindFirstChildOfClass("Humanoid").MaxHealth
					TopName.Visible = true	
					TopName.Text =
						"Health: " .. tostring(math.floor(v.Character:FindFirstChildOfClass("Humanoid").Health))
					TopName.Position = Vector2.new(BR.X, BR.Y)
					PlrName.Text = " " .. v.Name
					PlrName.Visible = true
					PlrName.Position = Vector2.new(TL.X, TL.Y)
					
					Top.Visible = true
					Left.Visible = true
					Bottom.Visible = true
					Right.Visible = true
				else 
					Top.Visible = false
					Left.Visible = false
					Bottom.Visible = false
					Right.Visible = false
					TopName.Visible = false
					PlrName.Visible = false
				end
			else 
				Top.Visible = false
				Left.Visible = false
				Bottom.Visible = false
				Right.Visible = false
				PlrName.Visible = false
				TopName.Visible = false
				if game.Players:FindFirstChild(v.Name) == nil then
				connection:Disconnect()
				end
			end
		end)
	end
	coroutine.wrap(ESP)()
end

game.Players.PlayerAdded:Connect(function(newplr) --Parameter gets the new player that has been added
	local Top = Drawing.new("Line")
	Top.Visible = false
	Top.From = Vector2.new(0, 0)
	Top.To = Vector2.new(200, 200)
	coroutine.wrap(function()
		while wait() do
			Top.Color = Color
		end
	end)()
	Top.Thickness = 2
	Top.Transparency = 1

	local Bottom = Drawing.new("Line")
	Bottom.Visible = false
	Bottom.From = Vector2.new(0, 0)
	Bottom.To = Vector2.new(200, 200)
	coroutine.wrap(function()
		while wait() do
			Bottom.Color = Color
		end
	end)()
	Bottom.Thickness = 2
	Bottom.Transparency = 1

	local Left = Drawing.new("Line")
	Left.Visible = false
	Left.From = Vector2.new(0, 0)
	Left.To = Vector2.new(200, 200)
	coroutine.wrap(function()
		while wait() do
			Left.Color = Color
		end
	end)()
	Left.Thickness = 2
	Left.Transparency = 1

	local Right = Drawing.new("Line")
	Right.Visible = false
	Right.From = Vector2.new(0, 0)
	Right.To = Vector2.new(200, 200)
	coroutine.wrap(function()
		while wait() do
			Right.Color = Color
		end
	end)()
	Right.Thickness = 2
	Right.Transparency = 1

	local TopName = Drawing.new("Text")
	coroutine.wrap(function()
		while wait() do
			TopName.Color = Color
		end
	end)()
	TopName.Outline = true
	TopName.Size = 20
	TopName.Center = false
	TopName.Visible = false
	TopName.Position = Vector2.new()-- these 2 don't matter, they get overwritten
	
	local PlrName = Drawing.new("Text")
	coroutine.wrap(function()
		while wait() do
			PlrName.Color = Color
		end
	end)()
	PlrName.Outline = true
	PlrName.Size = 20
	PlrName.Visible = false
	PlrName.Center = false 
	PlrName.Position = Vector2.new()-- these 2 don't matter, they get overwritten
	
	function ESP()
		local connection
		connection = game:GetService("RunService").RenderStepped:Connect(function()
			if newplr.Character ~= nil and newplr.Character:FindFirstChild("HumanoidRootPart") ~= nil and newplr.Name ~= plr.Name  and newplr.Character.Humanoid.Health > 0 then
				local ScreenPos, OnScreen = camera:WorldToViewportPoint(newplr.Character.HumanoidRootPart.Position)
				if OnScreen then
					local Scale = newplr.Character.Head.Size.Y/2
					local Size = Vector3.new(2, 3, 0) * (Scale * 2)
					local humpos = camera:WorldToViewportPoint(newplr.Character.HumanoidRootPart.Position)
					local TL = camera:WorldToViewportPoint((newplr.Character.HumanoidRootPart.CFrame * CFrame.new(Size.X, Size.Y, 0)).p)
					local TR = camera:WorldToViewportPoint((newplr.Character.HumanoidRootPart.CFrame * CFrame.new(-Size.X, Size.Y, 0)).p)
					local BL = camera:WorldToViewportPoint((newplr.Character.HumanoidRootPart.CFrame * CFrame.new(Size.X, -Size.Y, 0)).p)
					local BR = camera:WorldToViewportPoint((newplr.Character.HumanoidRootPart.CFrame * CFrame.new(-Size.X, -Size.Y, 0)).p)

					Top.From = Vector2.new(TL.X, TL.Y)
					Top.To = Vector2.new(TR.X, TR.Y)

					Left.From = Vector2.new(TL.X, TL.Y)
					Left.To = Vector2.new(BL.X, BL.Y)

					Right.From = Vector2.new(TR.X, TR.Y)
					Right.To = Vector2.new(BR.X, BR.Y)

					Bottom.From = Vector2.new(BL.X, BL.Y)
					Bottom.To = Vector2.new(BR.X, BR.Y)
					
					local healthRatio =
						newplr.Character:FindFirstChildOfClass("Humanoid").Health /
						newplr.Character:FindFirstChildOfClass("Humanoid").MaxHealth
					TopName.Visible = true
					TopName.Text =
						"Health: " .. tostring(math.floor(newplr.Character:FindFirstChildOfClass("Humanoid").Health))
					TopName.Position = Vector2.new(Bl.X, Bl.Y)
					PlrName.Text = " " .. newplr.Name
					PlrName.Visible = true
					PlrName.Position = Vector2.new(TL.X, TL.Y)
					
					Top.Visible = true
					Left.Visible = true
					Bottom.Visible = true
					Right.Visible = true
				else 
					Top.Visible = false
					Left.Visible = false
					Bottom.Visible = false
					Right.Visible = false
					TopName.Visible = false
					PlrName.Visible = false
				end
			else 
				Top.Visible = false
				Left.Visible = false
				Bottom.Visible = false
				Right.Visible = false
				PlrName.Visible = false
				TopName.Visible = false
				if game.Players:FindFirstChild(newplr.Name) == nil then
					connection:Disconnect()
				end
			end
		end)
	end
	coroutine.wrap(ESP)()
end)
